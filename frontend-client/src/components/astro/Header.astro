---
import { HeaderCart } from "@/components/react/HeaderCart";

interface Props {
    logoUrl: string | null;
    name: string;
    menuLink?: string;
    homeLink?: string;
    features?: Record<string, boolean>;
    showCart?: boolean;
}

const {
    logoUrl,
    name,
    menuLink = "/menu",
    homeLink = "/",
    features = {},
    showCart = true,
} = Astro.props;

const hasVideo = features["feat_video"] === true;
const hasServices = features["feat_services"] === true;

// Build navigation links based on active features
const navLinks = [
    { label: "INICIO", href: `${homeLink}#hero`, show: true },
    { label: "NOSOTROS", href: `${homeLink}#content`, show: true },
    { label: "MEN√ö", href: menuLink, isHighlighted: true, show: true },
    { label: "SERVICIOS", href: `${homeLink}#services`, show: hasServices },
    { label: "VIDEO", href: `${homeLink}#video`, show: hasVideo },
    { label: "S√çGUENOS", href: `${homeLink}#instagram`, show: true },
].filter((link) => link.show);
---

<header
    class="bg-white border-b border-gray-200/60 fixed top-0 left-0 w-full z-[100] h-20 shadow-sm"
>
    <div
        class="max-w-7xl mx-auto h-full flex items-center justify-between px-4 lg:px-8"
    >
        <!-- Logo & Name -->
        <a href={homeLink} class="flex items-center gap-3 group min-w-[180px]">
            {
                logoUrl ? (
                    <img
                        src={logoUrl}
                        alt={name}
                        class="w-10 h-10 object-contain"
                    />
                ) : (
                    <div class="text-2xl">üç¥</div>
                )
            }
            <span
                class="font-serif font-bold text-base md:text-lg tracking-wide text-gray-900 uppercase group-hover:text-gray-600 transition-colors whitespace-nowrap truncate max-w-[200px] sm:max-w-none"
            >
                {name}
            </span>
        </a>

        <!-- Centered Navigation -->
        <nav
            class="hidden lg:flex items-center gap-8 absolute left-1/2 -translate-x-1/2"
        >
            {
                navLinks.map((link) => (
                    <a
                        href={link.href}
                        target={
                            link.href.startsWith("http") ? "_blank" : undefined
                        }
                        rel={
                            link.href.startsWith("http")
                                ? "noopener noreferrer"
                                : undefined
                        }
                        data-astro-reload={
                            link.href.includes("#") ? "" : undefined
                        }
                        class:list={[
                            "text-[13px] font-medium tracking-wider transition-colors py-2",
                            link.isHighlighted
                                ? "text-gray-900 border-b-2 border-gray-900"
                                : "text-gray-600 hover:text-gray-900 border-b-2 border-transparent hover:border-gray-300",
                        ]}
                    >
                        {link.label}
                    </a>
                ))
            }
        </nav>

        <!-- Right Side: CTA -->
        <div class="flex items-center gap-4 min-w-[180px] justify-end">
            <!-- Cart Icon -->
            {showCart && <HeaderCart client:only="react" />}

            <!-- ORDER ONLINE Button -->
            <a
                href={menuLink}
                target={menuLink.startsWith("http") ? "_blank" : undefined}
                rel={menuLink.startsWith("http")
                    ? "noopener noreferrer"
                    : undefined}
                class="hidden md:inline-flex items-center gap-2 bg-gray-900 text-white px-5 py-2.5 text-xs font-semibold tracking-widest uppercase hover:bg-gray-800 transition-all duration-200 shadow-md hover:shadow-lg"
            >
                ORDENAR
            </a>

            <!-- Mobile Menu Button -->
            <button
                id="mobile-menu-btn"
                class="lg:hidden p-2 text-gray-700 hover:text-gray-900 transition-colors"
                aria-label="Abrir men√∫"
            >
                <svg
                    class="w-6 h-6"
                    fill="none"
                    stroke="currentColor"
                    viewBox="0 0 24 24"
                >
                    <path
                        stroke-linecap="round"
                        stroke-linejoin="round"
                        stroke-width="1.5"
                        d="M4 6h16M4 12h16M4 18h16"></path>
                </svg>
            </button>
        </div>
    </div>

    <!-- Decorative line under header -->
    <div
        class="absolute bottom-0 left-1/2 -translate-x-1/2 w-16 h-[2px] bg-gray-300"
    >
    </div>
</header>

<!-- Fullscreen Mobile Navigation -->
<div
    id="mobile-menu"
    class="fixed inset-0 bg-white z-[200] hidden opacity-0 transition-opacity duration-300"
>
    <!-- Mobile Menu Header -->
    <div
        class="flex items-center justify-between px-4 h-20 border-b border-gray-100"
    >
        <!-- Logo & Name -->
        <a href={homeLink} class="flex items-center gap-3">
            {
                logoUrl ? (
                    <img
                        src={logoUrl}
                        alt={name}
                        class="w-10 h-10 object-contain"
                    />
                ) : (
                    <div class="text-2xl">üç¥</div>
                )
            }
            <span
                class="font-serif font-bold text-base tracking-wide text-gray-900 uppercase"
            >
                {name}
            </span>
        </a>

        <!-- Cart & Close Button -->
        <div class="flex items-center gap-4">
            {showCart && <HeaderCart client:only="react" />}
            <button
                id="mobile-menu-close"
                class="p-2 text-gray-700 hover:text-gray-900 transition-colors"
                aria-label="Cerrar men√∫"
            >
                <svg
                    class="w-7 h-7"
                    fill="none"
                    stroke="currentColor"
                    viewBox="0 0 24 24"
                >
                    <path
                        stroke-linecap="round"
                        stroke-linejoin="round"
                        stroke-width="1.5"
                        d="M6 18L18 6M6 6l12 12"></path>
                </svg>
            </button>
        </div>
    </div>

    <!-- Navigation Links -->
    <nav class="px-6 py-8" id="mobile-nav">
        {
            navLinks.map((link) => (
                <a
                    href={link.href}
                    data-astro-reload={link.href.includes("#") ? "" : undefined}
                    class:list={[
                        "mobile-nav-link block py-5 text-lg font-medium tracking-wide uppercase transition-colors border-b border-gray-100",
                        link.isHighlighted
                            ? "text-gray-900"
                            : "text-gray-600 hover:text-gray-900",
                    ]}
                >
                    {link.label}
                </a>
            ))
        }
    </nav>
</div>

<script>
    document.addEventListener("astro:page-load", () => {
        const openBtn = document.getElementById("mobile-menu-btn");
        const closeBtn = document.getElementById("mobile-menu-close");
        const menu = document.getElementById("mobile-menu");
        const mobileLinks = document.querySelectorAll(".mobile-nav-link");

        function openMenu() {
            menu?.classList.remove("hidden");
            document.body.style.overflow = "hidden";
            setTimeout(() => {
                menu?.classList.remove("opacity-0");
            }, 10);
        }

        function closeMenu() {
            menu?.classList.add("opacity-0");
            document.body.style.overflow = "";
            setTimeout(() => {
                menu?.classList.add("hidden");
            }, 300);
        }

        openBtn?.addEventListener("click", openMenu);
        closeBtn?.addEventListener("click", closeMenu);
        mobileLinks.forEach((link) =>
            link.addEventListener("click", closeMenu),
        );
    });
</script>
